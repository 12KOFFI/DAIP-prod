{% extends 'base_view.html.twig' %}

{% block title %}Inscription{% endblock %}

{% block page_content %}
    <div class="container-fluid overflow-hidden mb-5 py-5">
        <div class="row min-vh-100 g-0">
            {# Section Image #}
            <div class="col-lg-6 d-none d-lg-flex align-items-center justify-content-center p-0">
                <div class="position-relative w-100 h-100 bg-cover" 
                     style="background-image: url('{{ asset('front/image/login-bg.png') }}'); background-size: cover; background-position: center;">
                    <div class="position-absolute top-0 start-0 w-100 h-100" 
                         style="background: rgba(102, 126, 234, 0.85);">
                    </div>
                    <div class="position-absolute top-50 start-50 translate-middle text-center text-white w-75">
                        <img src="{{ asset('front/image/logo.png') }}" alt="Logo E2C" class="mb-4" style="max-width: 200px;">
                        <h2 class="fw-bold mb-3">Je m'inscris à l'Ecole de la Deuxième Chance</h2>
                        <p class="lead opacity-90">Créez votre compte en quelques secondes et accédez à toutes nos fonctionnalités</p>
                    </div>
                </div>
            </div>

            {# Section Formulaire #}
            <div class="col-lg-6 d-flex align-items-center justify-content-center p-4">
                <div class="w-100" style="max-width: 400px; margin: 0 auto;">
                    {# En-tête #}
                    <div class="text-center mb-5">
                        <i class="bi bi-person-badge text-primary display-4 mb-3"></i>
                        <h1 class="h2 fw-bold text-dark mb-2">Créer un compte</h1>
                        <p class="text-muted">Remplissez vos informations pour commencer</p>
                    </div>

                    {# Messages flash #}
                    {% for flashError in app.flashes('error') %}
                        <div class="alert alert-danger d-flex align-items-center" role="alert">
                            <i class="bi bi-exclamation-triangle-fill me-2"></i>
                            {{ flashError }}
                        </div>
                    {% endfor %}

                    {# Formulaire #}
                    {{ form_start(registrationForm, {'attr': {'class': 'needs-validation', 'novalidate': 'novalidate'}}) }}
                        
                        {# Email #}
                        <div class="mb-4">
                            <label for="{{ registrationForm.email.vars.id }}" class="form-label fw-semibold">
                                <i class="bi bi-envelope text-primary me-2"></i>Adresse email
                            </label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-end-0">
                                    <i class="bi bi-at text-muted"></i>
                                </span>
                                {{ form_widget(registrationForm.email, {
                                    'attr': {
                                        'class': 'form-control border-start-0 ps-0',
                                        'autocomplete': 'email',
                                        'placeholder': 'votre@email.com'
                                    }
                                }) }}
                            </div>
                            {{ form_errors(registrationForm.email) }}
                        </div>

                        {# Mot de passe #}
                        <div class="mb-4">
                            <label for="{{ registrationForm.plainPassword.vars.id }}" class="form-label fw-semibold">
                                <i class="bi bi-lock text-primary me-2"></i>Mot de passe
                            </label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-end-0">
                                    <i class="bi bi-key text-muted"></i>
                                </span>
                                {{ form_widget(registrationForm.plainPassword, {
                                    'attr': {
                                        'class': 'form-control border-start-0 ps-0 password-field',
                                        'autocomplete': 'new-password',
                                        
                                    }
                                }) }}
                                <button class="btn btn-outline-secondary border-start-0" type="button" onclick="togglePassword('password-field', this)">
                                    <i class="bi bi-eye" id="password-field-icon"></i>
                                </button>
                            </div>
                            <div class="form-text">
                                <i class="bi bi-info-circle me-1"></i>Le mot de passe doit contenir au moins 6 caractères.
                            </div>
                            {{ form_errors(registrationForm.plainPassword) }}
                        </div>

                        {# Confirmation mot de passe #}
                        <div class="mb-4">
                            <label for="{{ registrationForm.confirmPassword.vars.id }}" class="form-label fw-semibold">
                                <i class="bi bi-lock-fill text-primary me-2"></i>Confirmer le mot de passe
                            </label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-end-0">
                                    <i class="bi bi-key-fill text-muted"></i>
                                </span>
                                {{ form_widget(registrationForm.confirmPassword, {
                                    'attr': {
                                        'class': 'form-control border-start-0 ps-0 confirm-password-field',
                                        'autocomplete': 'new-password',
                                        
                                    }
                                }) }}
                                <button class="btn btn-outline-secondary border-start-0" type="button" onclick="togglePassword('confirm-password-field', this)">
                                    <i class="bi bi-eye" id="confirm-password-field-icon"></i>
                                </button>
                            </div>
                            {{ form_errors(registrationForm.confirmPassword) }}
                        </div>

                        {# Bouton d'inscription #}
                        <div class="d-grid mb-4">
                            <button type="submit" class="btn btn-primary btn-lg py-3 fw-semibold">
                                <i class="bi bi-person-plus me-2"></i>S'inscrire
                            </button>
                        </div>

                        {# Lien de connexion #}
                        <div class="text-center">
                            <p class="text-muted mb-0">Déjà un compte ? 
                                <a href="{{ path('app_login') }}" class="text-primary text-decoration-none fw-semibold">
                                    <i class="bi bi-box-arrow-in-right me-1"></i>Connectez-vous
                                </a>
                            </p>
                        </div>
                    {{ form_end(registrationForm) }}
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
<script>
function togglePassword(fieldClass, button) {
    // Trouver le champ de mot de passe correspondant
    const passwordField = document.querySelector('.' + fieldClass);
    const icon = button.querySelector('i');
    
    if (passwordField.type === 'password') {
        passwordField.type = 'text';
        icon.classList.remove('bi-eye');
        icon.classList.add('bi-eye-slash');
        button.title = 'Masquer le mot de passe';
    } else {
        passwordField.type = 'password';
        icon.classList.remove('bi-eye-slash');
        icon.classList.add('bi-eye');
        button.title = 'Afficher le mot de passe';
    }
}

// Initialiser les tooltips
document.addEventListener('DOMContentLoaded', function() {
    const buttons = document.querySelectorAll('[onclick^="togglePassword"]');
    buttons.forEach(button => {
        button.title = 'Afficher le mot de passe';
    });
});
</script>
{% endblock %}